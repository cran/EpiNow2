<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Model definition: estimate_infections()</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>







<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Model definition: estimate_infections()</h1>



<p><strong>This is a work in progress. Please consider submitting a PR to improve it.</strong></p>
<p><code>estimate_infections()</code> supports a range of model formulation. Here we describe the most commonly used and highlight other options.</p>
<div id="renewal-equation-model" class="section level2">
<h2>Renewal equation model</h2>
<p>This is the default model and is used when <code>rt != NULL</code>.</p>
<div id="initialisation" class="section level3">
<h3>Initialisation</h3>
<p>The model is initialised prior to the first observed data point by assuming constant exponential growth for the mean of assumed delays from infection to case report.</p>
<p><span class="math display">\[\begin{align}
  I_{t} &amp;= I_0 \exp  \left(r t \right)  \\
  I_0 &amp;\sim \mathcal{LN}(\log I_{obs}, 0.2) \\
  r &amp;\sim \mathcal{LN}(r_{obs}, 0.2)
\end{align}\]</span></p>
</div>
<div id="within-the-range-of-observations" class="section level3">
<h3>Within the range of observations</h3>
<p>Where <span class="math inline">\(I_{obs}\)</span> and <span class="math inline">\(r_{obs}\)</span> are estimated from the first week of observed data. For the time window of the observed data infections are then modelled by weighting previous infections by the generation time and scaling by the instantaneous reproduction number. These infections are then convolved to cases by of onset date (<span class="math inline">\(O_t\)</span>) and cases by date of report (<span class="math inline">\(D_t\)</span>) using log-normal delay distributions (though arbitrary delay distributions can be used this is the most common formulation). This model can be defined mathematically as follows,</p>
<p><span class="math display">\[\begin{align}
  \log R_{t} &amp;= \log R_{t-1} + \mathrm{GP}_t \\
  I_t &amp;= R_t \sum_{\tau = 1}^{T_I} w(\tau | \mu_{w}, \sigma_{w}) I_{t - \tau} \\
  O_t &amp;= \sum_{\tau = 0}^{T_O} \xi_{O}(\tau | \mu_{\xi_{O}}, \sigma_{\xi_{O}}) I_{t-\tau} \\
  D_t &amp;= \alpha \sum_{\tau = 0}^{T_D} \xi_{D}(\tau | \mu_{\xi_{D}}, \sigma_{\xi_{D}}) O_{t-\tau} \\
  C_t &amp;\sim \mathrm{NB}\left(\omega_{(t \mod 7)}D_t, \phi\right)
\end{align}\]</span></p>
<p>Where <span class="math inline">\(T_I\)</span> is the maximum generation time, <span class="math inline">\(T_O\)</span> is the maximum delay from infection to case onset, <span class="math inline">\(T_D\)</span> is the maximum delay from case onset to report, and <span class="math inline">\(\alpha\)</span> is the proportion of cases that are ultimately reported (again note these are all optional and arbitrary).</p>
<p>The delay distributions are then defined as follows,</p>
<p><span class="math display">\[\begin{align}
     w &amp;\sim \mathcal{Gamma}(\mu_{w}, \sigma_{w}) \\
    \xi_{O} &amp;\sim \mathcal{LogNormal}(\mu_{\xi_{O}}, \sigma_{\xi_{O}}) \\
    \xi_{D} &amp;\sim \mathcal{LogNormal}(\mu_{\xi_{D}}, \sigma_{\xi_{D}})
\end{align}\]</span></p>
<p>This model used the following priors for the observation model</p>
<p><span class="math display">\[\begin{align}
    \frac{\omega}{7} &amp;\sim \mathrm{Dirichlet}(1, 1, 1, 1, 1, 1, 1) \\
    \phi &amp;\sim \frac{1}{\sqrt{\mathcal{N}(0, 1)}}
\end{align}\]</span></p>
<p><span class="math inline">\(\phi\)</span> is truncated to be greater than 0 and with <span class="math inline">\(\xi\)</span>, and <span class="math inline">\(w\)</span> normalised to sum to 1. Other priors are set by the user.</p>
<p><span class="math inline">\(GP_t\)</span> is an approximate Hilbert space Gaussian process as defined in<span class="citation"><sup>[1]</sup></span> using a Matern 3/2 kernel with a default boundary factor of 1.5 and basis functions scaled to be 20% of the number of days fitted. The length scale of the Gaussian process was given a log-normal prior with a mean of 21 days, and a standard deviation of 7 days truncated to be greater than 3 days and less than the length of the time-series. The standard deviation of magnitude of the Gaussian process was assumed to be 0.1. These settings are all changeable by the user. In addition the user can opt to make use of a different generative process or to instead remove the dependency on the previous value of <span class="math inline">\(R_t\)</span> each of these options impacts run-time and may alter the best use-case for the model.</p>
</div>
<div id="beyond-the-forecast-horizon" class="section level3">
<h3>Beyond the forecast horizon</h3>
<p>Beyond the forecast horizon (<span class="math inline">\(T\)</span>), by default, the Gaussian process is assumed to continue. However, here again there are a range of options. These included fixing transmission dynamics, and scaling <span class="math inline">\(R_t\)</span> based on the proportion of the population that remain susceptible. This is defined as followed,</p>
<p><span class="math display">\[\begin{equation}
    I_t = (N - I^c_{t-1}) \left(1 - \exp \left(\frac{-I&#39;_t}{N - I^c_{T}}\right)\right),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(I^c_t = \sum_{s&lt; t} I_s\)</span> are cumulative infections by <span class="math inline">\(t-1\)</span> and <span class="math inline">\(I&#39;_t\)</span> are the unadjusted infections defined above. This adjustment is based on the one implemented in the <code>epidemia</code> R package.<span class="citation"><sup>[2]</sup></span></p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-approxGP">
<p>1. Riutort-Mayol, G., BÃ¼rkner, P.-C., Andersen, M. R., Solin, A., &amp; Vehtari, A. (2020). <em>Practical hilbert space approximate bayesian gaussian processes for probabilistic programming</em>. <a href="https://arxiv.org/abs/2004.11408">https://arxiv.org/abs/2004.11408</a></p>
</div>
<div id="ref-bhattSemiMechanisticBayesianModeling">
<p>2. Bhatt, S., Ferguson, N., Flaxman, S., Gandy, A., Mishra, S., &amp; Scott, J. A. (n.d.-). <em>Semi-Mechanistic Bayesian modeling of COVID-19 with Renewal Processes</em>. 14.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
